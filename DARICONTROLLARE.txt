ER -manca durata in oggetto_in_asta (cambiare anche nome)


CREATE DEFINER=`root`@`localhost` PROCEDURE `aggiornamento_categoria`(
	var_nuovo_nome VARCHAR(45),
    var_vecchio_nome VARCHAR(45),
    var_nuovo_nome_macrocategoria VARCHAR(45)
)
BEGIN
   DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        ROLLBACK;
        RESIGNAL;
    END;
 END; 
 /*   
    DECLARE var_categoria_superiore VARCHAR(45);
    
	set transaction isolation level read uncommitted; #VALUTARE
	start transaction;
    
    SELECT categoria_superiore
    from categoria
    where nome_categoria = var_vecchio_nome;
    
    UPDATE categoria 
    SET	nome_categoria = var_nuovo_nome
    WHERE nome_categoria = var_vecchio_nome;

#/*if var_nuovo_nome_macrocategoria is not  null  then
		UPDATE categoria
		SET	categoria_superiore = var_nuovo_nome_categoria
		WHERE categoria_superiore = var_categoria_superiore OR (categoria_superiore = null AND nome_categoria = var_nuovo_nome);
	end if;
 /*  
END